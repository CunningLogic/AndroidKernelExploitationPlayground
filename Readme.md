#Linux Kernel Exploitation on Android#
This repository is meant to serve as a hands on guide to Linux kernel exploitation with a special interest in Android. All the resources you need for setting up an exploitation play ground will be explained below.  Each folder should have it's own challenge in the form of a loadable kernel module, it's own solution - code that will be executed from userspace to take advantage of the vulnerability (usually to gain us root), and a bit of a writeup about the vulnerability and the exploit.  

I am hoping that this will serve as a jumpstart for people to get started with kernel exploitation as well as a learning exercise for myself.  Feel free to fork and submit pull reqs for new challenges, documentations, etc.. 

##Prepare Your Device for the Challeges##

The kernels and the challenges will initially be made with the Nexus phones in mind, but with some work, should be adaptable to whatever you have on hand to test on.  The kernel exploitation challenges are built as loadable kernel modules.  Android's newer devices do not have module support by default. We need to boot an Android kernel that has module support to load our vulnerable LKM.  Prebuilt kernels for a few devices have been added to the bin folder. Support for more would be great.

There are prebuilt kernels for the Nexus 5 (hammerhead) and the Nexus 4 (mako) in the bin folder.  These have module support enabled. Enabling kernel modules was the only change from the sock build.  You can boot this by puting your phone into it's bootloader using adb (adb reboot bootloader) or holding a particular button sequence.

Booting the kernel in the following manner will not persist this kernel across device reboots. It is probably not a good idea to leave module support enabled on a device you are using for your daily driver.  Then again, it is probably not a good idea to attempt kernel exploitation on a device you are relying on.

```
fastboot boot bin/hammerhead_boot_3.4-kk-r1_LKM.img
```

After your device has booted, you can check the kernel version:

```
cat /proc/version
Linux version 3.4.0-g9eb14ba-dirty (fuzion24@bitbox) (gcc version 4.7 (GCC) ) #1 SMP PREEMPT Wed Jan 29 12:29:27 EST 2014
```

And validate that module support is enabled.  The modules entry in proc will not be available if module support is not enabled.

```
shell@hammerhead:/ $ ls -l /proc/modules
-r--r--r-- root     root            0 2014-01-30 18:36 modules
```

##Loading a Challenge##

After preparing your device to be able to load the LKM of choice, Choose the challenge you would like an


Kernel Bug classes
Print format string
Buffer overflow (stack and heap)
Array index

##Building the Kernel and LKMs yourself##

Follow google kernel building instructions?
I added CONFIG_MODULES=y to hammerhead_defconfig
ARCH=arm SUBARCH=arm CROSS_COMPILE={AOSP}/prebuilts/gcc/linux-x86/arm/arm-eabi-4.7/bin/arm-eabi- make hammerhead_defconfig
after that generated the .config
i just did %s/=m/=y/g
and then it builds cleanly

I'm not sure what causes the defconfig to generate things =m when they are set to =y in the defconfig
Building the kernel or the kernel module with the NDK does not work.

http://git.zx2c4.com/kernel-pwn-challenge/commit/

http://www.phrack.org/issues.html?id=6&issue=64
http://www.slideshare.net/sciosecurity/linux-kernel-exploitation
http://phrack.org/issues.html?issue=66&id=15#article
http://www.attackingthecore.com/codex.php?chp=chapter8
http://resources.infosecinstitute.com/exploiting-linux-kernel-heap-corruptions-slub-allocator/


Set
```
CONFIG_MODULES=y
```
in defconfig .config


diff --git a/drivers/Makefile b/drivers/Makefile
index d55b035..35f65cd 100644
--- a/drivers/Makefile
+++ b/drivers/Makefile
@@ -5,6 +5,7 @@
 # Rewritten to use lists instead of if-statements.
 #
 
+obj-y                          += vulnerabilities/
 # GPIO must come after pinctrl as gpios may need to mux pins etc
 obj-y                          += pinctrl/
 obj-y                          += gpio/

