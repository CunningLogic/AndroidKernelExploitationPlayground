#Linux Kernel Exploitation on Android#
This repository is meant to serve as a hands on guide to Linux kernel exploitation with a special interest in Android. All the resources you need for setting up an exploitation play ground will be explained below.  Each folder should have it's own challenge in the form of a loadable kernel module, it's own solution - code that will be executed from userspace to take advantage of the vulnerability (usually to gain us root), and a bit of a writeup about the vulnerability and the exploit.  

I am hoping that this will serve as a jumpstart for people to get started with kernel exploitation as well as a learning exercise for myself.  Feel free to fork and submit pull reqs for new challenges, documentations, etc..

##Prepare Your Device for the Challeges##

The kernels and the challenges will initially be made with the Nexus phones in mind, but with some work, should be adaptable to whatever you have on hand to test on.  Prebuilt kernels for a few devices have been added to the bin folder. Support for more would be great.

There are prebuilt kernels for the Nexus 5 (hammerhead) and the Nexus 4 (mako) in the bin folder. You can boot this by puting your phone into it's bootloader using adb (adb reboot bootloader) or holding a particular button sequence.

Booting the kernel in the following manner will not persist this kernel across device reboots.

*** THESE KERNELS INTENTIONALLY MAKE YOUR DEVICE VULNERABLE ***


```
fastboot boot bin/hammerhead_boot_3.4-kk-r1_LKM.img
```

After your device has booted, you can check the kernel version:

```
cat /proc/version
Linux version 3.4.0-g380afe0-dirty (fuzion24@bitbox) (gcc version 4.7 (GCC) ) #7 SMP PREEMPT Sat Mar 1 15:05:14 EST 2014
```

Kernel Bug classes
Print format string
Buffer overflow (stack and heap)
Array index

http://git.zx2c4.com/kernel-pwn-challenge/commit/

http://www.phrack.org/issues.html?id=6&issue=64
http://www.slideshare.net/sciosecurity/linux-kernel-exploitation
http://phrack.org/issues.html?issue=66&id=15#article
http://www.attackingthecore.com/codex.php?chp=chapter8
http://resources.infosecinstitute.com/exploiting-linux-kernel-heap-corruptions-slub-allocator/


 It is necessary to know locations of certain functions inside the kernel.  In our case we are using shellcode that requires prepare_kernel_cred and commit_creds to set the current processes euid to 0 (root)

 There is a proc interface kallsyms (kallsysms) which names the exported kernel symbol as well as the address at which it is located. However, in recent kernel versions, Dan Rosenberg and others have restricted these symbols for viewing ionly by those with CAP_SYS_ADMIN privledeges: http://lwn.net/Articles/420403/

 with this enabled:
 ```
 adb shell cat /proc/kallsyms | grep commit_creds
 00000000 T commit_creds
 ```

 In order for this exploit to resolve symbols,
 you need to
 ````
   adb shell su -c "echo 0 > /proc/sys/kernel/kptr_restrict"
 ```

 And now we can properly see the kernel symbols and their addresses:
 ```
 adb shell cat /proc/kallsyms | grep commit_creds
 c008e138 T commit_creds
 ```

 This is a bit of a catch22, though.  In order to get root, you need root. There are other ways to get the kernel addresses for kernel symbols.  If you are able to obtain the boot.img for the device, you can analyze the kernel directly to extract the symbols of interest for your exploit.


http://www.cloud-sec.org/

https://defense.ballastsecurity.net/wiki/index.php/Kernel_exploits
